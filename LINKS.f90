!> @file
!> @brief Creates the linked cell lists for neighbour list updates
!> @details Called from UPDATE_NEIGHBOURLIST.f90

SUBROUTINE LINKS(HEAD,MAXNUMCELL,INDEX_LIST,N,CELL,NCELLX, NCELLY, NCELLZ, LCLIST)
  USE VAR
  IMPLICIT NONE
  INTEGER, INTENT(IN) :: MAXNUMCELL, N, INDEX_LIST(N)
  INTEGER, INTENT(IN) :: NCELLX, NCELLY, NCELLZ
  INTEGER, INTENT(INOUT) :: HEAD(MAXNUMCELL), CELL(N), LCLIST(N)
  INTEGER A,I,JCELL

  HEAD = 0
  DO A = 1,N
     I = INDEX_LIST(A)
     JCELL = 1 + INT((RXYZ(1,I) * BOXINV(1) + 0.5) * NCELLX) * NCELLZ * NCELLY &
               + INT((RXYZ(2,I) * BOXINV(2) + 0.5) * NCELLY) * NCELLZ &
               + INT((RXYZ(3,I) * BOXINV(3) + 0.5) * NCELLZ)
     LCLIST(A) = HEAD(JCELL)
     HEAD(JCELL) = A
     CELL(A) = JCELL

  END DO
  RETURN
END SUBROUTINE LINKS
