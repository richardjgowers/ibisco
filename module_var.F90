#ifndef DOXY_SKIP
#include "ibi-preprocess.h"
#endif
!*MODULE VAR

!> @file
!> @brief Contains all the global variables throughout the program

MODULE VAR

  !UNIT CONSTANTS
  REAL*4, PARAMETER :: KB = 1.380658D-23
  REAL*4, PARAMETER :: NA = 6.0221367D+23
  REAL*4, PARAMETER :: PI = 3.14159265358
  REAL*4, PARAMETER :: MMOLY = 0.012D0
  REAL*4 :: MASSSCALE, RSCALE, ESCALE, CONV
  REAL*4 :: TEMPSCALE, PSCALE, TIMESCALE, FSCALE, DSCALE, VSCALE
  REAL*4 :: D2R, R2D

  !These are called in WRITETRJ (binary file!) so need to remain strictly as these types
  INTEGER*4 :: NFRAME, NTRJ, NATOMS
  REAL*8, DIMENSION(2) :: EK
  REAL*4, DIMENSION(:), ALLOCATABLE :: NSX, NSY, NSZ, NVX, NVY, NVZ
  !End WRITETRJ stuff

  INTEGER*4 :: ENSEMBLE
  INTEGER*4 :: NITEMS, NCOARSE, NSTEP, NMOL 
  INTEGER*4 :: HALT_DRIFT
  INTEGER*4 :: NUPDATE
  CHARACTER(6), POINTER :: LABEL(:), NAME_LABEL(:)
  CHARACTER(72) :: TITLE
  INTEGER :: NONBEXC_ATOM, NONBEXC_BEAD
  INTEGER :: NVIRTA = 0, IBRDESCR
  INTEGER :: ISTOP, RESTART
  INTEGER :: STEP

  !Timing variables
  REAL*8, DIMENSION(2) :: t_LOOP 
  REAL*8, DIMENSION(2) :: t_FORCECALC
  REAL*8, DIMENSION(2) :: t_VIRTUAL_DEF, t_UPDATE_NEIGHBOURLIST
  REAL*8, DIMENSION(2) :: t_MAPS_atom, t_MAPS_bead, t_LINKS_atom, t_LINKS_bead
  REAL*8, DIMENSION(2) :: t_NEW_NEIGHBOUR_atom, t_NEW_NEIGHBOUR_bead
  REAL*8, DIMENSION(2) :: t_NEW_FORCE, t_NONBONDED_atom, t_NONBONDED_bead, t_DISTRIBUTE_VSFORCE
  REAL*8, DIMENSION(2) :: t_BONDED_FORCE, t_BONDS, t_ANGLES, t_TORSIONS, t_OUTOFPLANES
  REAL*8, DIMENSION(2) :: t_SHIFT, t_MOVE, t_MOMENTUM, t_SCALEBP
  REAL*8, DIMENSION(2) :: t_REPORTRESULTS, t_AVERAGE, t_WRITETRJ
  !End timing variables

  !Averaging and output variables
  REAL*8 :: POT_E, TOT_E, PRES(7), BOX(4), DENS
  REAL*8 :: AV_POT_E, AV_TOT_E, AV_PRES(7), AV_BOX(4), AV_DENS
  REAL*8, DIMENSION(3) :: AV_V_NB, AV_V_BOND, AV_V_ANGLE, AV_V_TORSION, AV_V_OOP
  REAL*8, DIMENSION(3) :: AV_TEMP, KIN_E, AV_KIN_E
  REAL*8, DIMENSION(3) :: V_BOND, V_ANGLE, V_TORSION, V_OOP, V_NB
  !End averaging and output variables

  INTEGER, POINTER :: TYPE_LABEL(:)
  INTEGER, POINTER :: NATM(:), ITYPE(:)

  ! Neighbourlists
  REAL*4 :: RLIST_ATOM, RCUT_ATOM, RCUTSQ_ATOM
  REAL*4 :: RLIST_BEAD, RCUT_BEAD, RCUTSQ_BEAD
  INTEGER :: MAXNAB_ATOM
  INTEGER :: MAXNAB_BEAD
  INTEGER :: MAX_CONTACT!Largest gap between 2 connected things
  INTEGER, PARAMETER :: MAXCONNECTIONS = 20 ! Limit on neighbour exclusions
  INTEGER, POINTER :: CONNECTIONS(:), CONNECTED_TO(:,:)
  INTEGER, ALLOCATABLE, DIMENSION(:) :: NNEBS
  INTEGER, POINTER :: LIST_ATOM(:,:)
  INTEGER, POINTER :: LIST_BEAD(:,:)
  INTEGER, POINTER :: CELL_ATOM(:), NCELL_ATOM(:), MAP_ATOM(:), LCLIST_ATOM(:), HEAD_ATOM(:)
  INTEGER, POINTER :: CELL_BEAD(:), NCELL_BEAD(:), MAP_BEAD(:), LCLIST_BEAD(:), HEAD_BEAD(:)
  INTEGER:: NCELLX_ATOM, NCELLY_ATOM, NCELLZ_ATOM
  INTEGER:: NCELLX_BEAD, NCELLY_BEAD, NCELLZ_BEAD
  INTEGER:: NUMCELL_ATOM, MAPSIZE_ATOM, MAXNUMCELL_ATOM, MAXMAPSIZE_ATOM
  INTEGER:: NUMCELL_BEAD, MAPSIZE_BEAD, MAXNUMCELL_BEAD, MAXMAPSIZE_BEAD
  ! End neighbourlists

  REAL*4 :: VOLUME, INV_VOLUME
  REAL*4 :: BOXX, BOXY, BOXZ, BOXXINV, BOXYINV, BOXZINV
  REAL*4 :: BOXX2, BOXY2, BOXZ2
  REAL*4 :: TOTMASS

  ! Thermostat variables
  REAL*4 :: TEMP_IN, FAC
  REAL*4 :: TEMP, TEMP_ATOM, TEMP_BEAD, TAUT
  REAL*4 :: TEMP0, DT0, TAUT0, TAUP0, PRESSURE0, INITIME, DT
  REAL*4 :: MKTEMP, MKTEMP_ATOM, MKTEMP_BEAD
  ! End thermostat variables

  !Barostat variables
  REAL*4 :: PFAC, BETA, BETA0
  REAL*4 :: TAUP, PRESSURE
  REAL*4 :: PT23, PT11, PT22, PT33, PT13, PT12
  INTEGER :: IAVP
  INTEGER, PARAMETER :: LIMAVP = 10
  REAL*4, POINTER :: SP(:)
  !End barostat variables

  ! Coordinate variables
  REAL*4, POINTER :: RX(:), RY(:), RZ(:) ! unfolded coords
  REAL*4, POINTER :: SX(:), SY(:), SZ(:) ! folded coords
  REAL*4, POINTER :: VX(:), VY(:), VZ(:)
  REAL*4, POINTER :: VTX(:),VTY(:),VTZ(:) !previous velocities for leapfrog
  REAL*4, ALLOCATABLE :: FX(:), FY(:), FZ(:)
  REAL*4, ALLOCATABLE :: FXNB(:), FYNB(:), FZNB(:) !for pressure calcs
  ! End coordinate variables

  !Forcefield information
  INTEGER*4 :: MAXINPUT, NDATA
  PARAMETER ( MAXINPUT = 100000, NDATA = 20000 )
  INTEGER :: NTYPE, NBTYPE, NNBTYPE, NATYPE, NTTYPE, NOTYPE
  REAL*4, POINTER :: RBOND(:,:), BOND_FORCE(:,:), BOND_POT(:,:) 
  REAL*4, POINTER :: RNBOND(:,:), NBOND_FORCE(:,:), NBOND_POT(:,:) 
  REAL*4, POINTER :: ANGLE(:,:), BEND_FORCE(:,:), BEND_POT(:,:)
  REAL*4, POINTER :: ANGLE_TOR(:,:), TOR_FORCE(:,:), TOR_POT(:,:)
  REAL*4, POINTER :: ANGLE_OOP(:,:), OOP_FORCE(:,:), OOP_POT(:,:)
  REAL*4, POINTER :: MASS(:), INVMASS(:), MASS0(:)
  REAL*4, POINTER :: BINNB(:), BINB(:), BINA(:)
  REAL*4, POINTER :: BINT(:), BINO(:)
  INTEGER, POINTER :: IBONDT(:,:), INBONDT(:,:), IANGT(:,:,:)
  INTEGER, POINTER :: ITORT(:,:,:,:), IOOPT(:,:,:,:)
  INTEGER, POINTER :: JANGLEIJK(:,:), KANGLEIJK(:,:)
  INTEGER, POINTER :: NOJANGLEIJK(:,:), NOKANGLEIJK(:,:) 
  INTEGER, POINTER :: FJTORIJKL(:,:), FKTORIJKL(:,:), FLTORIJKL(:,:)
  INTEGER, POINTER :: JTORIJKL(:,:), KTORIJKL(:,:), LTORIJKL(:,:)
  INTEGER, POINTER :: JOOPIJKL(:,:), KOOPIJKL(:,:), LOOPIJKL(:,:)
  INTEGER, ALLOCATABLE, DIMENSION(:) :: BOND_TYPE_LABEL, ANGLE_TYPE_LABEL
  INTEGER, ALLOCATABLE, DIMENSION(:) :: TORSION_TYPE_LABEL, OOP_TYPE_LABEL 
  INTEGER, POINTER :: NBONDS(:), JBOND(:,:)
  INTEGER, POINTER :: NIJK(:), ATIANG(:) !RECORD TYPE OF ATOMS WHICH HAS ANGLE INTERACTIONS
  INTEGER, POINTER :: NIJKL(:), NOOPIJKL(:)
  INTEGER, POINTER :: NOANGLEIJK(:),FNIJKL(:) 
  INTEGER, POINTER :: NDATB(:),NDATAN(:),NDATT(:),NDATNB(:), NDATO(:)
  ! End forcefield information

  !     Variables for Hybrid Description
  INTEGER, POINTER :: VIRT_NUMATOMS(:), VIRT_CENTER(:), VIRT_VS_IND(:), VIRT_ATM_IND(:,:)
  REAL*4, POINTER :: VIRT_MASS(:), VIRT_INVMASS(:), VIRT_MASSCOEFF(:,:)
  character(len=7),pointer  :: name_mol(:)
  INTEGER, ALLOCATABLE :: MOL(:)
  INTEGER :: NUMATOMS, NUMBEADS
  INTEGER, POINTER :: ATOM(:), BEAD(:)
  INTEGER, POINTER :: VITYPE(:) ! Might be able to get rid of this?

#ifdef DEBUG_OOP
  !     Variables for Testing the OOP with the Atomistic PolyStyrene
  REAL*4 :: VOOP_ring,VOOP_LD,VOOP_L,VOOP_D
#endif

  !     Variables for MTS
  INTEGER :: MTS_CHECK,type_mts,I0,I1,I2,I3,I4,I5,MTSPARAM2,TSMTS,MTSPARAM,Kmts
  REAL*4 :: idt,idt2,idt3,idt4,idt5,mtsdt2,dt3,dt4,dt5
  REAL*4,POINTER :: FXi0(:),FYi0(:),FZi0(:) 
  REAL*4,POINTER :: FXi1(:),FYi1(:),FZi1(:) 
  REAL*4,POINTER :: FXii(:),FYii(:),FZii(:) 
  REAL*4,POINTER :: FXiii(:),FYiii(:),FZiii(:) 
  REAL*4,POINTER :: FXiiii(:),FYiiii(:),FZiiii(:) 
  ! End MTS variables

END MODULE VAR
