!> @file
!> @brief Resets the net momentum
!> @details Called from NEW_LOOP.f90

SUBROUTINE MOMENTUM ()

  USE VAR
  IMPLICIT NONE

  INTEGER :: I, TI
  REAL*4, DIMENSION(3) :: SUM_XYZ
  REAL*4 :: REG_MASS, INV_MASS

  SUM_XYZ = 0.0

  DO I = 1, NATOMS
     TI = ITYPE(I)
     REG_MASS = MASS(TI)
     SUM_XYZ(1) = SUM_XYZ(1) + VXYZ(1,I) * REG_MASS
     SUM_XYZ(2) = SUM_XYZ(2) + VXYZ(2,I) * REG_MASS
     SUM_XYZ(3) = SUM_XYZ(3) + VXYZ(3,I) * REG_MASS
  END DO

  SUM_XYZ(1) = SUM_XYZ(1) / REAL(NATOMS)
  SUM_XYZ(2) = SUM_XYZ(2) / REAL(NATOMS)
  SUM_XYZ(3) = SUM_XYZ(3) / REAL(NATOMS)

  !	CHANGE THE VELOCITES SUCH THAT TOTAL MOMENTUM IN EACH DIRECTION IS SETED TO ZERO
  DO I = 1, NATOMS
     TI = ITYPE(I)
     INV_MASS = INVMASS(TI)
     VXYZ(1,I) = VXYZ(1,I) - SUM_XYZ(1) * INV_MASS
     VXYZ(2,I) = VXYZ(2,I) - SUM_XYZ(2) * INV_MASS
     VXYZ(3,I) = VXYZ(3,I) - SUM_XYZ(3) * INV_MASS
  END DO

  RETURN
END SUBROUTINE MOMENTUM
